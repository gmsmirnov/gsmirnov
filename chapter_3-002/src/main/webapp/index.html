<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bootstrap Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        /**
         * Validates if "login", "password", "email" or "description" are empty and alerts.
         *
         * @returns {boolean} true if there is no one of those fields is empty.
         */
        function validate() {
            var result = true;
            if (document.getElementsByName("login")[0].value == '') {
                alert("Please correct login.");
                result = false;
            } else if (document.getElementsByName("password")[0].value == '') {
                alert("Please correct password.");
                result = false;
            } else if (document.getElementsByName("email")[0].value == '') {
                alert("Please correct email.");
                result = false;
            } else if (document.getElementsByName("description")[0].value == '') {
                alert("Please correct description.");
                result = false;
            }
            return result;
        }

        /**
         * Append a new user to the table. Consists of two parts: first validates input, second create POST request
         * to "jsonController".
         */
        function add() {
            if (validate()) {
                createUser();
            }
        }

        /**
         * Creates POST request to jsonController and transfers new user's specification.
         * @returns {boolean} false
         */
        function createUser() {
            $.ajax("./json", {
                method : "post",
                data : {
                    login : $("#login").val(),
                    password : $("#password").val(),
                    email : $("#email").val(),
                    country : $("#country").val(),
                    city : $("#city").val()
                },
                success : updateTable()
            });
            return false;
        }

        /**
         * Updates table after new user creation.
         */
        function updateTable() {
            $.ajax("./json", {
                method : "get",
                complete : function(data) {
                    console.log(JSON.parse(data.responseText));
                    var result =
                        "<thead>" +
                        "   <tr>" +
                        "       <th>Login</th>" +
                        "       <th>Email</th>" +
                        "       <th>Country</th>" +
                        "       <th>City</th>" +
                        "   </tr>" +
                        "</thead>" +
                        "<tbody>";
                    var users = JSON.parse(data.responseText);
                    for (var index = 0; index < users.length; index++) {
                        result += "<tr>" +
                            "                <th>" + users[index].login + "</th>" +
                            "                <th>" + users[index].email + "</th>" +
                            "                <th>" + users[index].country + "</th>" +
                            "                <th>" + users[index].city + "</th>" +
                            "            </tr>";
                    }
                    result += "</tbody>";
                    var table = document.getElementById("table");
                    table.innerHTML = result;
                }
            })
        }

        /**
         * F5 - reloads page and current table.
         */
        $(
            $.ajax("./json", {
                method : "get",
                complete : function(data) {
                    console.log(JSON.parse(data.responseText));
                    var result =
                        "<thead>" +
                        "   <tr>" +
                        "       <th>Login</th>" +
                        "       <th>Email</th>" +
                        "       <th>Country</th>" +
                        "       <th>City</th>" +
                        "   </tr>" +
                        "</thead>" +
                        "<tbody>";
                    var users = JSON.parse(data.responseText);
                    for (var index = 0; index < users.length; index++) {
                        result += "<tr>" +
                        "                <th>" + users[index].login + "</th>" +
                        "                <th>" + users[index].email + "</th>" +
                        "                <th>" + users[index].country + "</th>" +
                        "                <th>" + users[index].city + "</th>" +
                        "            </tr>";
                    }
                    result += "</tbody>";
                    var table = document.getElementById("table");
                    table.innerHTML = result;
                }
            })
        );

    </script>
</head>
<body>

    <div class="container">
        <form action="" method="post" onsubmit="add(); return false;">
            <h2>Add user</h2>
            <div class="form-group">
            <label for="login">Login:</label><br/>
            <input type="text" name="login" id="login">
            </div>
            <div class="form-group">
            <label for="password">Password:</label><br/>
            <input type="password" name="password" id="password">
            </div>
            <div class="form-group">
            <label for="email">E-mail:</label><br/>
            <input type="email" name="email" id="email">
            </div>
            <div class="form-group">
            <label>Gender:</label>
            <br/>
            <input type="radio" name="gender" value="male" checked> Male<br>
            <input type="radio" name="gender" value="female"> Female<br>
            </div>
            <div class="country">
                <label for="country">Country:</label><br/>
                <input type="text" name="country" id="country">
            </div>
            <div class="city">
                <label for="login">City:</label><br/>
                <input type="text" name="city" id="city">
            </div>
            <div class="form-group">
            <label>Description:</label>
            <br/>
            <textarea name="description" rows="10" cols="30">Write down description here.</textarea>
            </div>
            <br/>
            <div class="form-group"><input type="button" value="Ajax" name="ajax" onclick="return add();">
            </div>
        </form>
    </div>

    <div class="container">
        <h2>Users</h2>
        <table class="table table-striped" id="table">
            <thead>
            <tr>
                <th>Login</th>
                <th>Email</th>
                <th>Country</th>
                <th>City</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>

</body>
</html>